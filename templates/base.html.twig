<!DOCTYPE html>

{% set user_entity_id = app.session.get('user_entity_id') %}

<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}- Prescripció social Roquetes{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
        <link rel="stylesheet" href="/styles/style.css">
        <link rel="stylesheet" href="/styles/navbar.css">

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        {% block jsLinks %}{% endblock %}

    </head>
    <body>
    {% if (is_granted("IS_AUTHENTICATED_FULLY") or is_granted("IS_AUTHENTICATED_REMEMBERED"))%}
        <nav class="ps-navbar navbar navbar-expand navbar-dark bg-primary-dark position-relative">
            <div class="container">
                <div class="d-flex justify-content-end align-items-center w-100">
                    <div class="d-flex justify-content-between flex-grow-1">
                    {# TODO CODICIONAL ACT_EDIOTR AND ACT_PRESCRIPTOR #}
                    {% if (is_granted("ROLE_PRESCRIPTOR")) %}
                        <a class="navbar-brand" href=" {{ path('activity_list_prescriptor') }}">
                    {% elseif (is_granted("ROLE_EDITOR")) %}
                        <a class="navbar-brand" href=" {{ path('activity_list_editor') }}">
                    {% else %}
                        <a class="navbar-brand" href=" {{ path('user_entities') }}">
                    {% endif %}
                            <img class="nav__logo" src="{{ asset('/res/LogoP-S.png') }}" alt="Logo" />
                            <h1 class="navbar__title">PS Roquetes</h1>
                        </a>
                    </div>
                    <div class="collapse navbar-collapse d-flex justify-content-end">
                        <ul class="navbar-nav mb-2 mb-lg-0" id="lateral-menu">
                            <!-- Llista d'entitats -->
                            {# <li class="nav-item">
                                <a class="nav-link my-2 px-3" aria-current="page" href="{{ path('entity_list') }}">Entitats</a>
                            </li> #}
                            {% if (is_granted("ROLE_EDITOR"))%}
                            <!-- Llista d'activitats editor -->
                            <li class="nav-item">
                                <a class="nav-link m-2 px-3 {{app.request.get('_route') == 'activity_list_editor' ? 'active'}}" aria-current="page" href="{{ path('activity_list_editor') }}">Activitats de l'entitat</a>
                            </li>
                            {% endif %}
                            {% if (is_granted("ROLE_PRESCRIPTOR"))%}
                            <!-- Llista d'activitats prescriptor -->
                            <li class="nav-item">
                                <a class="nav-link m-2 px-3 {{app.request.get('_route') == 'activity_list_prescriptor' ? 'active'}}" aria-current="page" href="{{ path('activity_list_prescriptor') }}">Activitats prescripció</a>
                            </li>
                            {% endif %}
                            {% if (is_granted("ROLE_PRESCRIPTOR"))%}
                            <!-- Historial de participants del servei -->
                            <li class="nav-item">
                                <a class="nav-link m-2 px-3 {{app.request.get('_route') == 'participant_list' ? 'active'}}" href="{{ path('participant_list') }}">Participants del servei</a>
                            </li>
                            {% endif %}
                        </ul>
                        <div class="nav__toggle ms-5" id="" onclick="toggleMenu()">
                            <div class="nav__toggle-item nav__toggle-lin1"></div>
                            <div class="nav__toggle-item nav__toggle-lin2"></div>
                            <div class="nav__toggle-item nav__toggle-lin3"></div>
                        </div>
                        <!-- PERFILE USER -->
                        <div class="user-menu-wrapper">
                            <div class="m-2 ms-3 nav-menu-button">
                                <a href="#" class="paper-menu-trigger align-items-center justify-content-center d-flex">
                                    <div class="nav-menu-portrait">
                                        <img src="{{ asset(path('user_picture', (app.user.picture) ?  {'picture': app.user.picture} :  {'picture': 'default.png'})) }}" 
                                            style="object-fit:contain;max-height:350px;width:100%;" alt="Imagen de {{app.user.username}}" 
                                            title="Imagen de {{app.user.username}}">
                                    </div>
                                </a>
                            </div>

                            <div class="paper-context">
                                <div class="paper-context-header bg-primary-light">
                                    {% set roles = [] %}
                                    {% set entity = '' %}
                                    {% for userEntity in app.user.userEntities %}
                                        {% if userEntity.id == user_entity_id %}
                                            <div class="paper-context-equipment">{{ userEntity.entity.name }}</div>
                                            {% set entity = userEntity.entity %}
                                            {% set roles = userEntity.roles %}
                                            {% set break = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% for role in roles %}
                                        {% if role == "ROLE_ADMIN_ENTITY" %}
                                            <div class="paper-context-role">Administrador</div>
                                        {% endif %}
                                        {% if role == "ROLE_EDITOR" %}
                                            <div class="paper-context-role">Editor</div>
                                        {% endif %}
                                        {% if role == "ROLE_PRESCRIPTOR" %}
                                            <div class="paper-context-role">Prescriptor</div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="user__nav">
                                    <div class="profile-card"> 
                                        <div class="paper-context-portrait">
                                            <img src="{{ asset(app.user.picture ? path('user_picture', {'picture': app.user.picture}) : path('user_picture', {'picture': 'default.png'})) }}" style="object-fit:contain;max-height:350px;width:100%;" alt="Imagen de {{app.user.username}}" title="Imagen de {{app.user.username}}">
                                            <div class="paper-context-portrait-change"><a href="{{ path('user_edit') }}" class="text-light text-decoration-none">Change</a></div>
                                        </div>
                                        <div class="primary-profile-info">
                                            <div class="name">{{ app.user.username }}</div>
                                            <div class="email">{{ app.user.email }}</div>
                                        </div>
                                    </div>
                                    <ul aria-hidden="true" class="user-nav__ul list--plain" role="menu">
                                        <a href="">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Notifications</title><path d="M427.68 351.43C402 320 383.87 304 383.87 217.35 383.87 138 343.35 109.73 310 96c-4.43-1.82-8.6-6-9.95-10.55C294.2 65.54 277.8 48 256 48s-38.21 17.55-44 37.47c-1.35 4.6-5.52 8.71-9.95 10.53-33.39 13.75-73.87 41.92-73.87 121.35C128.13 304 110 320 84.32 351.43 73.68 364.45 83 384 101.61 384h308.88c18.51 0 27.77-19.61 17.19-32.57zM320 384v16a64 64 0 01-128 0v-16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                                                    </div>
                                                        Notificacions
                                                </span>
                                            </li>
                                        </a>
                                        <a href="">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Settings</title><path d="M262.29 192.31a64 64 0 1057.4 57.4 64.13 64.13 0 00-57.4-57.4zM416.39 256a154.34 154.34 0 01-1.53 20.79l45.21 35.46a10.81 10.81 0 012.45 13.75l-42.77 74a10.81 10.81 0 01-13.14 4.59l-44.9-18.08a16.11 16.11 0 00-15.17 1.75A164.48 164.48 0 01325 400.8a15.94 15.94 0 00-8.82 12.14l-6.73 47.89a11.08 11.08 0 01-10.68 9.17h-85.54a11.11 11.11 0 01-10.69-8.87l-6.72-47.82a16.07 16.07 0 00-9-12.22 155.3 155.3 0 01-21.46-12.57 16 16 0 00-15.11-1.71l-44.89 18.07a10.81 10.81 0 01-13.14-4.58l-42.77-74a10.8 10.8 0 012.45-13.75l38.21-30a16.05 16.05 0 006-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 00-6.07-13.94l-38.19-30A10.81 10.81 0 0149.48 186l42.77-74a10.81 10.81 0 0113.14-4.59l44.9 18.08a16.11 16.11 0 0015.17-1.75A164.48 164.48 0 01187 111.2a15.94 15.94 0 008.82-12.14l6.73-47.89A11.08 11.08 0 01213.23 42h85.54a11.11 11.11 0 0110.69 8.87l6.72 47.82a16.07 16.07 0 009 12.22 155.3 155.3 0 0121.46 12.57 16 16 0 0015.11 1.71l44.89-18.07a10.81 10.81 0 0113.14 4.58l42.77 74a10.8 10.8 0 01-2.45 13.75l-38.21 30a16.05 16.05 0 00-6.05 14.08c.33 4.14.55 8.3.55 12.47z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                                                    </div>
                                                        Configuració entitat
                                                </span>
                                            </li>
                                        </a>
                                        <a href="{{ path('user_edit')}}">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Settings</title><path d="M262.29 192.31a64 64 0 1057.4 57.4 64.13 64.13 0 00-57.4-57.4zM416.39 256a154.34 154.34 0 01-1.53 20.79l45.21 35.46a10.81 10.81 0 012.45 13.75l-42.77 74a10.81 10.81 0 01-13.14 4.59l-44.9-18.08a16.11 16.11 0 00-15.17 1.75A164.48 164.48 0 01325 400.8a15.94 15.94 0 00-8.82 12.14l-6.73 47.89a11.08 11.08 0 01-10.68 9.17h-85.54a11.11 11.11 0 01-10.69-8.87l-6.72-47.82a16.07 16.07 0 00-9-12.22 155.3 155.3 0 01-21.46-12.57 16 16 0 00-15.11-1.71l-44.89 18.07a10.81 10.81 0 01-13.14-4.58l-42.77-74a10.8 10.8 0 012.45-13.75l38.21-30a16.05 16.05 0 006-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 00-6.07-13.94l-38.19-30A10.81 10.81 0 0149.48 186l42.77-74a10.81 10.81 0 0113.14-4.59l44.9 18.08a16.11 16.11 0 0015.17-1.75A164.48 164.48 0 01187 111.2a15.94 15.94 0 008.82-12.14l6.73-47.89A11.08 11.08 0 01213.23 42h85.54a11.11 11.11 0 0110.69 8.87l6.72 47.82a16.07 16.07 0 009 12.22 155.3 155.3 0 0121.46 12.57 16 16 0 0015.11 1.71l44.89-18.07a10.81 10.81 0 0113.14 4.58l42.77 74a10.8 10.8 0 01-2.45 13.75l-38.21 30a16.05 16.05 0 00-6.05 14.08c.33 4.14.55 8.3.55 12.47z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                                                    </div>
                                                        Configuració usuari
                                                </span>
                                            </li>
                                        </a>
                                        <a href="{{ path('register', {'id' : entity.id}) }}">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                                                            <path d="M376 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" />
                                                            <path d="M288 304c-87 0-175.3 48-191.64 138.6-2 10.92 4.21 21.4 15.65 21.4H464c11.44 0 17.62-10.48 15.65-21.4C463.3 352 375 304 288 304z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32" />
                                                            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M88 176v112M144 232H32" />
                                                        </svg>
                                                    </div>
                                                        Crear un usuari
                                                </span>
                                            </li>
                                        </a>
                                        <a href="">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Globe</title><path d="M256 48C141.13 48 48 141.13 48 256s93.13 208 208 208 208-93.13 208-208S370.87 48 256 48z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path d="M256 48c-58.07 0-112.67 93.13-112.67 208S197.93 464 256 464s112.67-93.13 112.67-208S314.07 48 256 48z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path d="M117.33 117.33c38.24 27.15 86.38 43.34 138.67 43.34s100.43-16.19 138.67-43.34M394.67 394.67c-38.24-27.15-86.38-43.34-138.67-43.34s-100.43 16.19-138.67 43.34" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32" d="M256 48v416M464 256H48"/></svg>
                                                    </div>
                                                        Idioma
                                                </span>
                                            </li>
                                        </a>
                                        <a href="{{ path('logout') }}">
                                            <li role="menuitem">
                                                <span class="menu-item-wrap">
                                                    <div class="fav-apps__app-icon doc-outline">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                                                            <path d="M304 336v40a40 40 0 01-40 40H104a40 40 0 01-40-40V136a40 40 0 0140-40h152c22.09 0 48 17.91 48 40v40M368 336l80-80-80-80M176 256h256" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" />
                                                        </svg>
                                                    </div>
                                                        Tancar sessió
                                                </span>
                                            </li>
                                        </a>
                                    </ul>
                                </div>
                            </div>
                        </div>
                     </div>
                </div>
            </div>
            </nav>
    {% endif %}

        <main class="container-xl my-5">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        {% block breadcrumbs %}
                            {% if (is_granted("IS_AUTHENTICATED_FULLY") or is_granted("IS_AUTHENTICATED_REMEMBERED"))%}
                                <li class="breadcrumb-item" aria-current="page"><a href="{{ path('user_entities') }}">Les meves entitats</a></li>
                            {% endif %}
                        {% endblock %}
                    </ol>
                </nav>
            {% block main %}
                {% block success %}
                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show">
                            {{message}}
                            <button type="button" class="close btn-close" data-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endblock %}
            {% endblock %}
        </main>

        <script type="text/javascript" src="/js/common.js"></script>
    </body>
</html>
